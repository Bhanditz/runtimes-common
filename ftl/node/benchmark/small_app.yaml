# This is a 'small' node app, with 1 dependency (20th percentile of all node projects with dependencies)
steps:
  - name: 'ubuntu'
    args: ['chmod', 'a+rx', '-R', '/workspace']
# Build benchmark image with bazel
  - name:  'gcr.io/cloud-builders/bazel'
    args: ['run','ftl/node/benchmark:node_benchmark_image', '--', '--norun']
# Bazel build par file
  - name:  'gcr.io/cloud-builders/bazel'
    args: ['build','ftl:node_builder.par']
# Run benchmark on small app
  - name:  'bazel/ftl/node/benchmark:node_benchmark_image'
    args: ['--base', 'gcr.io/google-appengine/nodejs:latest',
           '--name', 'gcr.io/ftl-node-test/benchmark-small-app:latest',
           '--directory', '/workspace/ftl/node/benchmark/data/small_app',
           '--description', 'small app',
           '--iterations', '5']
